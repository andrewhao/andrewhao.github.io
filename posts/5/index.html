
<!doctype html>
<!-- START OF _layouts/default.html -->
<html lang="en">
	<head>
		<meta charset="utf-8">
		<meta content="IE=edge,chrome=1" http-equiv="X-UA-Compatible" >
		<meta content="width=device-width,initial-scale=1" name="viewport">
		<meta content="Andrew Hao's thoughts on software engineering, team leadership & product design." name="description">
		<meta content="The Sweet Spot" name="author">

		<title>The Sweet Spot</title>

		<!-- Styles -->
		<link href="/stylesheets/main.css" rel="stylesheet">

		<!-- Google webfonts -->
    <link href="https://fonts.googleapis.com/css?family=Cousine|Suez+One|Yellowtail|Space+Mono|Alike+Angular" rel="stylesheet">

		<!-- jQuery and plugins -->
		<script src="//ajax.googleapis.com/ajax/libs/jquery/1.8.2/jquery.min.js"></script>
		<script src="/js/jquery.zclip.min.js"></script>

		<!-- Syntax highlighter -->
		<link href="/stylesheets/prettify-hemisu.css" type="text/css" rel="stylesheet" />
    <script type="text/javascript" src="/js/prettify.js"></script>

    <link href="/atom.xml" rel="alternate" title="The Sweet Spot" type="application/atom+xml">
    
  <script type="text/javascript">
    var _gaq = _gaq || [];
    _gaq.push(['_setAccount', 'UA-2330913-9']);
    _gaq.push(['_trackPageview']);

    (function() {
      var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
      ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
      var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
    })();
  </script>



  </head>

	<body onload="prettyPrint()">
		<div class="wrap">

			<header>
        <a href="/"><div class="title">The Sweet Spot</div></a>
				<div class="subtitle">On software, engineering leadership, and anything shiny.</div>

				<div class="navi">
					<ul>
						<li><a href="/blog/archives">Articles</a></li>
						<li><a href="/talks">Talks</a></li>
						<li><a href="/notes">Conference Notes</a></li>
						<li><a href="https://www.github.com/andrewhao">Github</a></li>
						<li><a href="https://twitter.com/andrewhao">Twitter</a></li>
					</ul>
				</div> <!-- // .navi -->
			</header>

				<!-- START OF index.html -->

	
		
		<!-- START OF _includes/article.html -->
<article>
	<header>
		<h1><a href="/2014/04/26/implementing-ddd-chapter-2/">Implementing DDD: Domains, Subdomains and Bounded Contexts</a></h1>
		<time>26 April 2014</time>
	</header>
		<div class="content">
			<h2 id="chapter-2-domains-subdomains-and-bounded-contexts">Chapter 2: Domains, Subdomains, and Bounded Contexts</h2>

<p>A <em>Domain</em> is what a business does and the surrounding context of how it does business. It is important to model out its supported <em>Subdomains</em> – that is, the smaller components of the business that collaborate in real, day-to-day operations of the business. The book describes these as <em>Core Domains</em>.</p>

<p>Finally, a <em>Bounded Context</em> is the physical manifestation of the solution space as software – models living in a real application. Its key feature in the context of DDD is as a linguistic barrier between different domains.</p>

<p>In an ideal world, each <em>Subdomain</em> maps directly to one <em>Bounded Context</em>. In the real world, this is less common since we tend to build things into monolithic systems. Still – many monolithic applications have several components that could in themselves be bounded contexts.</p>

<h6 id="side-note-in-rails-one-could-think-of-engines-as-a-bounded-context-but-that-might-be-a-blog-post-for-another-time">Side note: In Rails, one could think of Engines as a <em>Bounded Context</em>. But that might be a blog post for another time.</h6>

<p>It is important to get these ideas and concepts down correctly because we need correct modeling of our systems to determine what they do.</p>

<h3 id="bounded-contexts-and-terms">Bounded Contexts and terms</h3>

<p>It’s not usually realistic to get the entire organization agreeing on a universal linguistic definition for every term. Instead, DDD assumes that different terms have different meanings in different contexts.</p>

<p>The author then dives into the an example of a book, where a <em>book</em> means several different things to different people in different contexts. A book is touched upon by authors, graphic designers, editors, marketing folks. In each of these contexts, the features of a book mean different things at different times. It is impossible to develop an all-knowing Book model without disagreement between stakeholders. DDD, instead, acknowledges these differences and allows stakeholders to use linguistic terms from within their unique Bounded Contexts.</p>

<p>Bounded Contexts may include things like:</p>

<ul>
  <li>Object models</li>
  <li>A database schema / persistence layer</li>
  <li>A SOAP or REST API</li>
  <li>A user interface</li>
</ul>

<h3 id="bounded-context-antipatterns">Bounded context antipatterns</h3>

<p>You may be tempted to divide up a bounded context by architectural concerns, or because you want to assign smaller tasks to developers (resource allocation). Beware that this kind of work tends to fragment the language.</p>

<p>DDD operates on <em>linquistic drivers</em>. The unity, cohesion and domain-adherence of the bounded context should be the first priority in the design.</p>

<p>Assigning two teams to the same bounded context results in fragmentation of the bounded context.</p>

<p>Ideally: we strive to assign one team to work on one Bounded Context with one Ubiquitous Language at a time.</p>

<h6 id="in-rails-what-are-the-bounded-contexts-it-could-be-the-top-level-rails-application-or-an-engine-or-a-gem-that-define-the-context-boundaries">In Rails, what are the bounded contexts? It could be the top-level Rails application, or an engine, or a gem, that define the context boundaries._</h6>

<h3 id="a-story">A story…</h3>

<p>The chapter then goes on to describe their fictional team designing through three iterations off their DDD strategy:</p>

<p>A system in which all domains live within the same bounded context. They see the folly of this and refactor with some tactical patterns, like creating services.</p>

<p>This is, however, missing the point. They realized they needed to listen to business and their domain experts to find out exactly where the right places were to segregate the contexts. The team discovers that the business has a desire to go in a new direction which allows them to segregate the domain in such a way that would enable future directions for the business.</p>

<h6 id="how-often-are-we-as-developers-in-conversation-with-our-product-owners-and-asking-where-the-business-wants-to-go-in-the-future">How often are we as developers in conversation with our product owners and asking where the business <em>wants</em> to go in the future?</h6>

<p>Conversations with the business reveal an intention to develop an add-on product to the core product. This implies the development of two subdomains. However, further investigation reveals that the shared overlap of certain domain models (like users, roles, and access management) cannot simply be identically shared between two systems, since their <em>linguistic meanings</em> in the two systems differ slightly. Instead, the developers use the linguistic problem to develop a third bounded context.</p>

<p>The developers separate their app into three bounded contexts built as three software systems.</p>

			
			
		</div>
	<footer>
		


		



  
		
			Tagged under
		
    <a class='category' href='/category/book-review/'>book review</a>, <a class='category' href='/category/ddd/'>ddd</a>, <a class='category' href='/category/domain-driven-design/'>domain-driven design</a>
	


	
	
	</footer>
	
</article>
<!-- END OF _includes/article.html -->

	
		
		<!-- START OF _includes/article.html -->
<article>
	<header>
		<h1><a href="/2014/03/08/six-months-as-a-manager/">Six months as a manager</a></h1>
		<time>08 March 2014</time>
	</header>
		<div class="content">
			<p>It’s been approximately six months since I’ve entered engineering management. Here are some thoughts reflecting back on that season now.</p>

<h2 id="i-didnt-like-it-at-first">I didn’t like it at first.</h2>

<p>Let’s face it: I didn’t like the feeling of being a “manager” now. It comes with too much baggage of pointy-haired bosses or ineffective waste layers. Why do we need managers anyways?</p>

<p>More to the point: I love coding. I love working on rewarding projects. I hated the thought of being tied up in meetings while day by day getting more and more disconnected from code.</p>

<p>So I struggled a lot in those first few months (still do), trying to maintain the balance of working with product management to get a strategic vision communicated, or with other engineering teams to get a tactical vision in place, versus trying to be deeply involved with the code base and doing code reviews.</p>

<h3 id="you-cant-code-anymore">You can’t code anymore.</h3>

<p>In the end? I had to come to grips with the reality that my team needed me in a different role – a strategic role, helping them see the big picture, sniffing out dependencies and destroying blockers before they got to them.</p>

<p>But I still needed to be spot-on with the code – I still needed to be in the know with new product features as they are being developed. So it’s my priority to be in design discussions, but I can’t be the implementer anymore.</p>

<p>So I’ve started a change in mindset – how can offload all the random codebase knowledge I’ve acquired over the years to the team? How can I effectively share my expertise so I’m out of a (coding) job? I’m starting to be more convinced that the answer to that is pair programming.</p>

<h3 id="pairing-your-way-out-of-a-job">Pairing your way out of a job</h3>

<p>Nowadays if there’s a story or task in which I am the only one (or one of few) with domain knowledge about the feature, I’ll ask a team member to pair with me on the feature. That way we get a really effective teaching tool about the domain model, and the extra plus in that if I get pulled into a meeting, development can continue.</p>

<h3 id="but-you-still-have-to-code">But you still have to code.</h3>

<p>So I code on the weekends (not everybody can do this!)</p>

<p>We’re a Rails team taking on a new Ember project. I need to get my chops up around Ember so I’ve decided to pull in a <a href="https://github.com/andrewhao/hendrix">side project</a> to hack on the weekends. My side work on <a href="http://www.wejoinin.com">Wejoinin</a> lets me do all the Rails things I don’t get to do anymore at work.</p>

<p>And it works for me because I love to code, and to be honest, I don’t ever want to get weak in that area.</p>

<p>To be honest, I’d love more feedback from other engineering managers in that area. How do you keep your chops sharp?</p>

<h3 id="people-are-your-priority">People are your priority.</h3>

<p>I’ve read often that <a href="http://firstround.com/article/My-Management-Lessons-from-Three-Failed-Startups-Google-Apple-Dropbox-Twitter-and-Square">empathy is everything</a> when it comes to management, and it still rings true. No matter how this product launch goes, in the end your team will remember how you treated them, how their thoughts and feelings were taken into account.</p>

<p>One thing I’m trying to check myself is my tendency to jump in on other people’s sentences and cut them off. It sounds silly, but sometimes I realize I like to talk a lot more than listen. As a manager, sometimes you need to dwell on the feedback of a team member for some time before you write it off. There’s usually a core message in there that’s completely valid – a frustration, a desire for change. Empathy means communicating the message: “I heard you, and I respect your thoughts.”</p>

<h3 id="its-your-attitude">It’s your attitude</h3>

<p>And finally, here’s what I think: your attitude toward your company and the team make <em>ALL</em> the difference.</p>

<ul>
  <li>Is your orientation truly to support your team? How will it be clear in the long run that your supported someone in their career?</li>
  <li>Where are places in your workday where you can connect and sympathize with people – share a joke, listen to someone’s frustration, or just simply go out to lunch?</li>
  <li>How are you giving people something to work toward to: a vision of changing the world (for Blurb, it’s about transforming the publishing industry).</li>
  <li>How are you addressing negativity? Grumbling is important to address head on in its own space, but how are you empowering people to take charge of issues of culture or organizational friction?</li>
  <li>How are you checking your own negativity – sometimes we forget that we’re the solutions to our own problems, and I’ve found oftentimes that the very issues that you assume are impossible to change are crackable by having the right relationships with the right people.</li>
</ul>

<p>The little things matter.</p>

<h3 id="growth-areas">Growth areas</h3>

<p>Lord knows I have a lot to learn here. One area I’m learning to grow in is how to give honest and accurate feedback to team members, without fearing how they’re going to receive it.</p>

<p>Another area? Delegation. I’m learning to delegate the little micro-responsibilities in my job that I just kind of expect that I’m supposed to do. Case in point: every week we accept a translation import from a third-party translation service. I realized that I was burning a lot of time reviewing hundreds of lines of translation keys every week, and the repetition of it was sapping a lot of my energy. I had to learn to ask a team member for help and give them responsibility to own that function of the process.</p>

			
			
		</div>
	<footer>
		


		



  
		
			Tagged under
		
    <a class='category' href='/category/code/'>code</a>, <a class='category' href='/category/management/'>management</a>, <a class='category' href='/category/thoughts/'>thoughts</a>
	


	
	
	</footer>
	
</article>
<!-- END OF _includes/article.html -->

	
		
		<!-- START OF _includes/article.html -->
<article>
	<header>
		<h1><a href="/2014/02/02/blogging-through-implementing-domain-driven-design/">Blogging through: Implementing Domain-Driven Design</a></h1>
		<time>02 February 2014</time>
	</header>
		<div class="content">
			<p>In recent conversations with coworkers, the topic of Domain-Driven Design has<br />
arisen on more than a few occasions in design and architecture meetings.<br />
“Have you read it?” a coworker asked, “I think it’d help us a lot.”</p>

<p>I’ve gotten my hands on a copy of <a href="http://www.amazon.com/Implementing-Domain-Driven-Design-Vaughn-Vernon/dp/0321834577">Implementing Domain-Driven Design</a><br />
by <a href="https://vaughnvernon.co/">Vaughn Vernon</a>, which is a more pragmatic<br />
approach to DDD than the original <a href="http://www.amazon.com/Domain-Driven-Design-Tackling-Complexity-Software/dp/0321125215/ref=pd_bxgy_b_text_y">Domain-Driven Design</a> book by Eric Evans.</p>

<p>My desire is to share my outlines of the book chapter-by-chapter,<br />
hopefully once a week.</p>

<h2 id="chapter-1-getting-started-with-ddd">Chapter 1: Getting Started with DDD</h2>

<h3 id="can-i-ddd">Can I DDD?</h3>
<ul>
  <li>DDD helps us design software models where “our design is exactly how<br />
the software works” (1).</li>
  <li>DDD isn’t a technology, it’s a set of principles that involve<br />
discussion, listening, and business value so you can <em>centralize<br />
knowledge</em>.</li>
  <li>The main principle here is that we must “understand the business in<br />
which our software works” (3). This means we learn from domain experts<br />
in our field.</li>
  <li>What is a domain model? an object model where objects have<br />
data/persistence concerns with an accurate business meaning.</li>
</ul>

<h3 id="why-you-should-do-ddd">Why You Should Do DDD</h3>

<ul>
  <li>Domain experts and devs on same playing field, cooperation required as<br />
one team. (Agile teams, anyone?)</li>
  <li>The business can learn more about itself through the questions asked<br />
about itself.</li>
  <li>Knowledge is centralized.</li>
  <li>Zero translations between domain experts and software devs and<br />
software.</li>
  <li>“The design is the code, and code is the design.” (7)</li>
  <li>It is not without up-front cost</li>
</ul>

<h4 id="the-problem">The problem</h4>

<ul>
  <li>The schism between business domain experts and software developers<br />
puts your project (and your business) at a risk.</li>
  <li>The more time passes, the greater the divide grows.</li>
</ul>

<h4 id="solution">Solution</h4>

<ul>
  <li>DDD brings domain experts and software developers together to develop<br />
software that reflects the business domain mental model.</li>
  <li>Oftentimes this requires that they jointly develop a “Ubiquitous<br />
Language” - a shared vocabulary and set of concepts that are jointly<br />
spoken by everybody.</li>
  <li>DDD produces software that is better designed &amp; architected -&gt; better testable -&gt;<br />
clearer code.</li>
  <li>Take heed: DDD should only be used to simplify your domain. If the net<br />
cost of implementing DDD is only going to add complexity, then you<br />
should stay away.</li>
</ul>

<h4 id="domain-model-health">Domain model health</h4>
<ul>
  <li>As time passes, our domain models can become<br />
<a href="http://www.martinfowler.com/bliki/AnemicDomainModel.html">anemic</a>,<br />
and lose their expressive capabilities and clean boundaries. This can<br />
lead to spaghetti code and a violation of object responsibilities.</li>
  <li>Why do anemic domain models hurt us? They claim to be well-formed<br />
models but they hide a badly designed system that is still unfocused<br />
in what it does. (Andrew: I’ve seen a lot of Service objects that<br />
claim to be services but really are long scripts to get things done.<br />
There might be a cost of designing the Service interface, but inside<br />
things are just as messy as before we got there.)</li>
  <li>Seems like Vernon is blaming the influence of IDEs for Visual Basic as<br />
they influenced Java libraries – too many explicit getters and<br />
setters.</li>
  <li>Vernon throws up some code samples comparing two different code<br />
samples – one with an anemic model that looks like a long string of<br />
commands and another with descriptive method names. He makes the case<br />
that simply reading the code is documentation of the domain itself.</li>
</ul>

<h4 id="how-to-do-ddd">How to do DDD</h4>

<ul>
  <li>Have a <a href="http://martinfowler.com/bliki/UbiquitousLanguage.html"><em>Ubiquitous Language</em></a><br />
where the team of domain experts share the language together, from<br />
domain experts to programmers.</li>
  <li>
    <p>Steps to coming up with a language:</p>

    <ol>
      <li>Draw out the domain and label it.</li>
      <li>Make a glossary of terms and definitions.</li>
      <li>Have the team review the language document.</li>
    </ol>
  </li>
  <li>Note that a Ubiquitous Language is specific to the context it is<br />
implemented in. In other words, there is one Ubiquitous Language per<br />
Bounded Context.</li>
</ul>

<h3 id="business-value-of-ddd">Business value of DDD</h3>

<ol>
  <li>The organization gains a useful model of its domain</li>
  <li>The precise definition of the business is developed</li>
  <li>Domain experts contribute to software design.</li>
  <li>A better user experience is gained.</li>
  <li>Clean boundaries for models keep them pure.</li>
  <li>Enterprise architecture is better designed.</li>
  <li>Continuous modeling is used – the working software we produce is the<br />
model we worked so hard to create.</li>
  <li>New tools and patterns are used.</li>
</ol>

<h4 id="challenges">Challenges</h4>

<ul>
  <li>The time and effort required to think about the busines domain,<br />
research concepts, and converse with domain experts.</li>
  <li>It may be hard to get a domain expert involved due to their<br />
availability.</li>
  <li>There is a lot of thought required to clarify pure models and do<br />
domain modeling.</li>
</ul>

<h4 id="tactical-modeling">Tactical modeling</h4>

<ul>
  <li>The <em>Core Domain</em> is the part of your application that has key and<br />
important business value – and may require high thought and attention<br />
to design.</li>
  <li>Sometimes DDD may not be the right fit for you – if you have a lot of<br />
experienced developers who are very comfortable with domain modeling,<br />
you may be better off trusting their opinion.</li>
</ul>

<h4 id="ddd-is-not-heavy">DDD is not heavy.</h4>

<ul>
  <li>It fits into any Agile or XP framework. It leans into TDD, eg: you use<br />
TDD to develop a new domain model that describes how it interacts with<br />
other existing models. You go through the red-green-refactor cycle.</li>
  <li>DDD promotes lightweight development. As domain experts read the code, they<br />
are able to provide in-flight feedback to the development of the<br />
system.</li>
</ul>


			
			
		</div>
	<footer>
		


		



  
		
			Tagged under
		
    <a class='category' href='/category/blog-a-book/'>blog a book</a>, <a class='category' href='/category/book-review/'>book review</a>, <a class='category' href='/category/ddd/'>ddd</a>, <a class='category' href='/category/domain-driven-design/'>domain-driven design</a>
	


	
	
	</footer>
	
</article>
<!-- END OF _includes/article.html -->

	
		
		<!-- START OF _includes/article.html -->
<article>
	<header>
		<h1><a href="/2014/01/26/moving-to-ember-app-kit/">Moving to Ember App Kit</a></h1>
		<time>26 January 2014</time>
	</header>
		<div class="content">
			<p>I’ve noticed a bit of the buzz around <a href="https://github.com/stefanpenner/ember-app-kit">Ember App Kit</a><br />
recently and decided to move Hendrix, my music management app, over from<br />
a <a href="http://yeoman.io/">Yeoman</a>-generated Ember app to EAK with all its<br />
bells and whistles.</p>

<h3 id="whats-the-difference">What’s the difference?</h3>

<p>Well on the surface, the two frameworks aren’t very different. The<br />
standard Yeoman build tool sets you up with Grunt and Bower, which is<br />
what EAK provides you out of the box. The cool stuff happens when you<br />
dive under the hood: ES6 module transpilation and an AMD-compatible<br />
Ember Resolver, built-in Karma integration and a built-in API stub<br />
framework for development and test environments.</p>

<h3 id="the-joys-of-modules">The joys of modules</h3>

<p>What I didn’t realize was that compiling to ES6 modules required that my<br />
filenames be renamed exactly how the modules were going to be placed,<br />
with the extra caveat that resource actions needed to live in their own<br />
directories. Recall that in the old way of doing things with globals and<br />
namespaces, you could get away with throwing a route file like this in<br />
your app directory:</p>

<figure class="code"><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class="line-number">1</span>
<span class="line-number">2</span>
</pre></td><td class="code"><pre><code class=""><span class="line">routes/
</span><span class="line">  songs_index_controller.js</span></code></pre></td></tr></table></div></figure>

<p>And inside:</p>

<figure class="code"><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class="line-number">1</span>
<span class="line-number">2</span>
<span class="line-number">3</span>
</pre></td><td class="code"><pre><code class="javascript"><span class="line"><span class="nx">MyApp</span><span class="p">.</span><span class="nx">SongsIndexRoute</span> <span class="o">=</span> <span class="nx">Ember</span><span class="p">.</span><span class="nx">Route</span><span class="p">.</span><span class="nx">extend</span><span class="p">({</span>
</span><span class="line">  <span class="c1">//...</span>
</span><span class="line"><span class="p">});</span>
</span></code></pre></td></tr></table></div></figure>

<p>In EAK’s world, you need to nest the file under the <code>songs/</code> directory,<br />
and strip the type from the filename, like so:</p>

<figure class="code"><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class="line-number">1</span>
<span class="line-number">2</span>
<span class="line-number">3</span>
</pre></td><td class="code"><pre><code class="javascript"><span class="line"><span class="nx">routes</span><span class="o">/</span>
</span><span class="line">  <span class="nx">songs</span><span class="o">/</span>
</span><span class="line">    <span class="nx">index</span><span class="p">.</span><span class="nx">js</span>
</span></code></pre></td></tr></table></div></figure>

<p>Inside the file, you assign the function to a variable and let it be<br />
exported in the default namespace.</p>

<figure class="code"><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class="line-number">1</span>
<span class="line-number">2</span>
<span class="line-number">3</span>
<span class="line-number">4</span>
</pre></td><td class="code"><pre><code class="javascript"><span class="line"><span class="kd">var</span> <span class="nx">SongsIndexRoute</span> <span class="o">=</span> <span class="nx">Ember</span><span class="p">.</span><span class="nx">Route</span><span class="p">.</span><span class="nx">extend</span><span class="p">({</span>
</span><span class="line">  <span class="c1">//...</span>
</span><span class="line"><span class="p">});</span>
</span><span class="line"><span class="kr">export</span> <span class="k">default</span> <span class="nx">SongsIndexRoute</span><span class="p">;</span>
</span></code></pre></td></tr></table></div></figure>

<h3 id="file-name-matters">File name matters</h3>

<p>The <a href="https://github.com/stefanpenner/ember-jj-abrams-resolver/">new Ember resolver</a> <br />
loads modules in a smart way – according to how the framework<br />
structures resources, controllers and their corresponding actions. So<br />
visiting <code>#/songs</code> from my app caused the app to look up and load<br />
<code>appkit/routes/songs/index</code>. What I didn’t realize was <em>this module must<br />
live at a very specific place in the file directory structure</em>.<br />
I realized that I left the module type in the file name the first time<br />
around, like this:</p>

<figure class="code"><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class="line-number">1</span>
<span class="line-number">2</span>
<span class="line-number">3</span>
</pre></td><td class="code"><pre><code class="javascript"><span class="line"><span class="nx">routes</span><span class="o">/</span>
</span><span class="line">  <span class="nx">songs</span><span class="o">/</span>
</span><span class="line">    <span class="nx">index_route</span><span class="p">.</span><span class="nx">js</span>
</span></code></pre></td></tr></table></div></figure>

<p>There are no types in the module names – or the filenames, for that<br />
matter. I had not realized this (I’m also an AMD newbie) – so I had<br />
left my files un-renamed as <code>songs_index_route</code>, which meant that<br />
the module loader had stored the SongsIndexRoute module under<br />
<code>appkit/routes/songs/index_route</code>, but was doing a route lookup through<br />
the Resolver for: <code>appkit/routes/songs/index</code>. Renaming the file to:</p>

<figure class="code"><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class="line-number">1</span>
<span class="line-number">2</span>
<span class="line-number">3</span>
</pre></td><td class="code"><pre><code class="javascript"><span class="line"><span class="nx">routes</span><span class="o">/</span>
</span><span class="line">  <span class="nx">songs</span><span class="o">/</span>
</span><span class="line">    <span class="nx">index</span><span class="p">.</span><span class="nx">js</span>
</span></code></pre></td></tr></table></div></figure>

<p>did the trick.</p>

			
			
		</div>
	<footer>
		


		



  
		
			Tagged under
		
    <a class='category' href='/category/development/'>development</a>, <a class='category' href='/category/ember/'>ember</a>, <a class='category' href='/category/ember-app-kit/'>ember app kit</a>, <a class='category' href='/category/programming/'>programming</a>
	


	
	
	</footer>
	
</article>
<!-- END OF _includes/article.html -->

	
		
		<!-- START OF _includes/article.html -->
<article>
	<header>
		<h1><a href="/2013/12/27/ember-data-rails-cors-and-you/">Ember Data, Rails, CORS, and you!</a></h1>
		<time>27 December 2013</time>
	</header>
		<div class="content">
			<p>I’m starting up a new personal project involving Ember-Data and Rails<br />
(more to come). The gist of it is that it’s a pure frontend app engine<br />
built in Yeoman and Grunt, and designed to talk to a remote API service<br />
built on Rails.</p>

<p>So since it’s a remote API, I’ve got to enable CORS, right?</p>

<h2 id="install-cors-via-rack-cors">Install CORS via rack-cors</h2>

<figure class="code"><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class="line-number">1</span>
<span class="line-number">2</span>
</pre></td><td class="code"><pre><code class="ruby"><span class="line"><span class="c1"># Gemfile</span>
</span><span class="line"><span class="n">gem</span> <span class="s2">&quot;rack-cors&quot;</span><span class="p">,</span> <span class="ss">:require</span> <span class="o">=&gt;</span> <span class="s2">&quot;rack/cors&quot;</span>
</span></code></pre></td></tr></table></div></figure>

<figure class="code"><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class="line-number">1</span>
<span class="line-number">2</span>
<span class="line-number">3</span>
<span class="line-number">4</span>
<span class="line-number">5</span>
<span class="line-number">6</span>
<span class="line-number">7</span>
<span class="line-number">8</span>
<span class="line-number">9</span>
<span class="line-number">10</span>
<span class="line-number">11</span>
<span class="line-number">12</span>
<span class="line-number">13</span>
<span class="line-number">14</span>
<span class="line-number">15</span>
<span class="line-number">16</span>
<span class="line-number">17</span>
</pre></td><td class="code"><pre><code class="ruby"><span class="line"><span class="c1"># config/application.rb</span>
</span><span class="line"><span class="n">config</span><span class="o">.</span><span class="n">middleware</span><span class="o">.</span><span class="n">use</span> <span class="no">Rack</span><span class="o">::</span><span class="no">Cors</span> <span class="k">do</span>
</span><span class="line">  <span class="n">allow</span> <span class="k">do</span>
</span><span class="line">    <span class="n">origins</span> <span class="s2">&quot;*&quot;</span>
</span><span class="line">
</span><span class="line">    <span class="n">resource</span> <span class="s2">&quot;*&quot;</span><span class="p">,</span>
</span><span class="line">      <span class="ss">:headers</span> <span class="o">=&gt;</span> <span class="ss">:any</span><span class="p">,</span>
</span><span class="line">      <span class="ss">:methods</span> <span class="o">=&gt;</span> <span class="o">[</span><span class="ss">:get</span><span class="p">,</span> <span class="ss">:post</span><span class="p">,</span> <span class="ss">:put</span><span class="p">,</span> <span class="ss">:delete</span><span class="p">,</span> <span class="ss">:options</span><span class="p">,</span> <span class="ss">:patch</span><span class="o">]</span>
</span><span class="line">    <span class="k">end</span>
</span><span class="line">
</span><span class="line">  <span class="n">allow</span> <span class="k">do</span>
</span><span class="line">    <span class="n">origins</span> <span class="s2">&quot;*&quot;</span>
</span><span class="line">    <span class="n">resource</span> <span class="s2">&quot;/public/*&quot;</span><span class="p">,</span>
</span><span class="line">      <span class="ss">:headers</span> <span class="o">=&gt;</span> <span class="ss">:any</span><span class="p">,</span>
</span><span class="line">      <span class="ss">:methods</span> <span class="o">=&gt;</span> <span class="ss">:get</span>
</span><span class="line">  <span class="k">end</span>
</span><span class="line"><span class="k">end</span>
</span></code></pre></td></tr></table></div></figure>

<p>A very naive implementation with zero security whatsoever. Anyways.<br />
Onward!</p>

<h2 id="get-ember-data-dsrestadapter-talkin-cors">Get Ember-Data DS.RESTAdapter talkin’ CORS</h2>

<p>I saw conflicting documentation on Ember-Data and CORS – it seemed like<br />
it should support CORS out of the box. Apparently this is not so.</p>

<p>In my ember app’s <code>store.js</code> (or anywhere your app loads before the<br />
application adapter is defined, do this:</p>

<figure class="code"><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class="line-number">1</span>
<span class="line-number">2</span>
<span class="line-number">3</span>
<span class="line-number">4</span>
<span class="line-number">5</span>
<span class="line-number">6</span>
<span class="line-number">7</span>
<span class="line-number">8</span>
<span class="line-number">9</span>
<span class="line-number">10</span>
<span class="line-number">11</span>
<span class="line-number">12</span>
</pre></td><td class="code"><pre><code class="javascript"><span class="line"><span class="err">#</span> <span class="nx">store</span><span class="p">.</span><span class="nx">js</span>
</span><span class="line"><span class="nx">$</span><span class="p">.</span><span class="nx">ajaxSetup</span><span class="p">({</span>
</span><span class="line">  <span class="nx">crossDomain</span><span class="o">:</span> <span class="kc">true</span><span class="p">,</span>
</span><span class="line">  <span class="nx">xhrFields</span><span class="o">:</span> <span class="p">{</span>
</span><span class="line">    <span class="nx">withCredentials</span><span class="o">:</span> <span class="kc">true</span>
</span><span class="line">  <span class="p">}</span>
</span><span class="line"><span class="p">});</span>
</span><span class="line">
</span><span class="line"><span class="nx">Hendrix</span><span class="p">.</span><span class="nx">Store</span> <span class="o">=</span> <span class="nx">DS</span><span class="p">.</span><span class="nx">Store</span><span class="p">.</span><span class="nx">extend</span><span class="p">();</span>
</span><span class="line"><span class="nx">Hendrix</span><span class="p">.</span><span class="nx">ApplicationAdapter</span> <span class="o">=</span> <span class="nx">DS</span><span class="p">.</span><span class="nx">RESTAdapter</span><span class="p">.</span><span class="nx">extend</span><span class="p">({</span>
</span><span class="line">  <span class="nx">host</span><span class="o">:</span> <span class="s2">&quot;http://localhost:3000&quot;</span><span class="p">,</span>
</span><span class="line"><span class="p">})</span>
</span></code></pre></td></tr></table></div></figure>

<p><a href="http://api.jquery.com/jQuery.ajaxSetup/"><code>$.ajaxSetup</code></a>, though its<br />
usage is not recommended, is designed to set global options on the<br />
jQuery <code>ajax</code> object. It provides some information on the options you can modify.</p>

<p>Why doesn’t Ember support this out of the box? I think it’s because they<br />
cannot support IE, where one must use an XDR object to support CORS.</p>

<p>I’ve posted an <a href="http://discuss.emberjs.com/t/ember-data-and-cors/3690">Ember follow-up question in the<br />
forums</a> for discussion.</p>

<h2 id="get-rails-talking-json-out-of-its-mimetype-confusion">Get Rails talking JSON out of its mimetype confusion.</h2>

<p>Did you know that if you rely on the <code>Accepts:</code> header in HTTP that<br />
Rails does not obey its ordering<code>*</code>? I was trying to figure out why my<br />
Rails controllers were trying to render HTML instead of JSON when the<br />
headers were:</p>

<p><code>'Accept: application/json, text/javascript, */*; q=0.01'</code></p>

<p>A <a href="https://github.com/rails/rails/issues/9940">very long winded<br />
discussion</a> on the Rails<br />
project reveals that, well, nobody has it figured out yet. Most modern<br />
browsers do obey <code>Accepts:</code> specificity, but for the sake of older<br />
browser compatibility, the best practice for browsers is still to return<br />
HTML when <code>*/*</code> is specified.</p>

<p>What does this mean for Rails developers who want to use <code>Accepts:</code><br />
mimetype lists? Well, we either wait for the Rails projects to support<br />
mimetype specificity (and for older browsers to die out), or we are<br />
encouraged to include the format explicitly in the URI.</p>

<p>I chose to have Ember append the <code>.json</code> suffix to the URL, thanks to<br />
this <a href="http://stackoverflow.com/questions/13648807/ds-model-url-not-working-in-ember-js">SO<br />
post</a></p>

<figure class="code"><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class="line-number">1</span>
<span class="line-number">2</span>
<span class="line-number">3</span>
<span class="line-number">4</span>
<span class="line-number">5</span>
<span class="line-number">6</span>
<span class="line-number">7</span>
<span class="line-number">8</span>
</pre></td><td class="code"><pre><code class="javascript"><span class="line"><span class="err">#</span> <span class="nx">store</span><span class="p">.</span><span class="nx">js</span>
</span><span class="line"><span class="nx">Hendrix</span><span class="p">.</span><span class="nx">ApplicationAdapter</span> <span class="o">=</span> <span class="nx">DS</span><span class="p">.</span><span class="nx">RESTAdapter</span><span class="p">.</span><span class="nx">extend</span><span class="p">({</span>
</span><span class="line">  <span class="nx">host</span><span class="o">:</span> <span class="s2">&quot;http://localhost:3000&quot;</span><span class="p">,</span>
</span><span class="line">  <span class="c1">// Force ember-data to append the `json` suffix</span>
</span><span class="line">  <span class="nx">buildURL</span><span class="o">:</span> <span class="kd">function</span><span class="p">(</span><span class="nx">record</span><span class="p">,</span> <span class="nx">suffix</span><span class="p">)</span> <span class="p">{</span>
</span><span class="line">    <span class="k">return</span> <span class="k">this</span><span class="p">.</span><span class="nx">_super</span><span class="p">(</span><span class="nx">record</span><span class="p">,</span> <span class="nx">suffix</span><span class="p">)</span> <span class="o">+</span> <span class="s2">&quot;.json&quot;</span><span class="p">;</span>
</span><span class="line">  <span class="p">}</span>
</span><span class="line"><span class="p">})</span>
</span></code></pre></td></tr></table></div></figure>

<p>More to come how how this app works.</p>

			
			
		</div>
	<footer>
		


		



  
		
			Tagged under
		
    <a class='category' href='/category/ajax/'>ajax</a>, <a class='category' href='/category/api/'>api</a>, <a class='category' href='/category/cors/'>cors</a>, <a class='category' href='/category/crossdomain/'>crossdomain</a>, <a class='category' href='/category/ember/'>ember</a>, <a class='category' href='/category/ember-data/'>ember data</a>, <a class='category' href='/category/json/'>json</a>, <a class='category' href='/category/rails/'>rails</a>
	


	
	
	</footer>
	
</article>
<!-- END OF _includes/article.html -->

	
	
<div class="pagination">
	
		<a class="older" href="/posts/6">Older</a>
	
	
	<span class="total">5 of 20</span>
	
	
		<a class="newer" href="/posts/4">Newer</a>
	
</div>
<!-- END OF index.html -->


			<footer>
				Copyright &copy; 2018

	Andrew Hao


				

<script type="text/javascript">
      var disqus_shortname = 'g9labs';
      
        
        var disqus_script = 'count.js';
      
    (function () {
      var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
      dsq.src = 'http://' + disqus_shortname + '.disqus.com/' + disqus_script;
      (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
    }());
</script>







  <script type="text/javascript">
    (function(){
      var twitterWidgets = document.createElement('script');
      twitterWidgets.type = 'text/javascript';
      twitterWidgets.async = true;
      twitterWidgets.src = 'http://platform.twitter.com/widgets.js';
      document.getElementsByTagName('head')[0].appendChild(twitterWidgets);
    })();
  </script>





			</footer>

		</div> <!-- // .wrap -->
  </body>

	<script>
		$(document).ready(function() {
			// Make images center
			$('p:has(img)').css('text-align', 'center');

			// Add the image's title attribute as a caption
			$('p:has(img)').append(function () {
				return '<div class="caption">' + ($('img', this).attr('title') || "") + '</div>';
			});

			// Prettify code
			$('code').addClass('prettyprint');
			$('pre code').addClass('linenums');

			// Copy to clipboard with button
			$('pre:has(code)').prepend(function(){
				return '<div class="clip-btn">copy to clipboard</div>';
      });

			$('.clip-btn').zclip({
				path:'/js/ZeroClipboard.swf',
				copy: $(this).next('code').text(),
				afterCopy: function(){
					$(this).replaceWith('<div class="clip-btn">copied!');
					}
			});
		});
	</script>
</html>
<!-- END OF _layouts/default.html -->
